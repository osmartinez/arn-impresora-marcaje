<style>
  .btn-updown {
    width: 30px;
    height: 30px;
  }
</style>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-4">
      <div class="row">
        <div class="col-md-4">
          <h3>Pares</h3>
        </div>
        <div class="col-md-8">
          <h3 class="font-weight-bold">0</h3>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <h3 class="text-right">Saldos</h3>
        </div>
        <div class="col-md-4">
          <h3 id="saldos" class="font-weight-bold">0</h3>
        </div>
        <div class="col-md-4">
          <div class="row">
            <div class="col-md-6">
              <a id="btn-restar-saldos" class="btn-floating btn-sm btn-danger"><i class="fas fa-minus"></i></a>
            </div>
            <div class="col-md-6">
              <a id="btn-sumar-saldos" class="btn-floating btn-sm btn-primary"><i class="fas fa-plus"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="row">
        <div class="col-md-12">
          <span></span>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="row">
        <div class="col-md-12">
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-4">
      <div class="row">
        <div class="col-md-12">
          <h3 class="font-weight-bold">Información</h3>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <span>Cliente:</span>
        </div>
        <div class="col-md-8">
          <span class="font-weight-bold"></span>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <span>Pedido:</span>
        </div>
        <div class="col-md-8">
          <span class="font-weight-bold"></span>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <span>Modelo:</span>
        </div>
        <div class="col-md-8">
          <span class="font-weight-bold"></span>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="row">
        <div class="col-md-12">
          <h3 class="font-weight-bold">Etiqueta</h3>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <span>Línea 1</span>
        </div>
        <div class="col-md-8">
          <input id="input-linea-1" type="text" />
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <span>Línea 2</span>
        </div>
        <div class="col-md-8">
          <input id="input-linea-2" type="text" />
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <span>Línea 3</span>
        </div>
        <div class="col-md-8">
          <input id="input-linea-3" type="text" />
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="row">
        <div class="col-md-12">
          <h3 class="font-weight-bold">Configuración</h3>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
        </div>
        <div class="col-md-6">
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
        </div>
        <div class="col-md-6">
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
        </div>
        <div class="col-md-6">
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  let saldos = 0
  let cadenaLectura = ''
  let leyendoCodigo = false
  let comunicandoImpresora = false
  const inputs = document.getElementsByTagName('INPUT')
  let elementoSaldos = document.getElementById('saldos')

  function desseleccionar() {
    var tmp = document.createElement("input");
    document.body.appendChild(tmp);
    tmp.focus();
    document.body.removeChild(tmp);
  }


  function limpiarCodigo() {
    for (const input of inputs) {
      if (input.value.includes(cadenaLectura)) {
        input.value = String(input.value).replace(cadenaLectura, '')
        input.value = input.value
      }
    }
  }

  function enviarTextoImpresora() {
    if (!comunicandoImpresora) {
      comunicandoImpresora = true
      setTimeout(() => {
        $.ajax({
          method: 'POST',
          timeout: 3000,
          url: `/dashboard/impresora/cambios`,
          dataType: 'json',
          contentType: 'application/json',
          data: JSON.stringify(
            {
              'linea1': document.getElementById('input-linea-1').value,
              'linea2': document.getElementById('input-linea-2').value,
              'linea3': document.getElementById('input-linea-3').value
            }),
          success: () => {
            comunicandoImpresora = false
          },
          error: (err) => {
            comunicandoImpresora = false
            console.log(err)
          }
        })
      }, 5000)
    }

  }

  // ¡¡ event listeners
  document.addEventListener("keyup", keyUp, false);
  for (const input of inputs) {
    input.addEventListener('keyup', enviarTextoImpresora, false)
  }
  document.getElementById('btn-restar-saldos').addEventListener('click', () => {
    let saldosActuales = Number(elementoSaldos.innerHTML)
    if (saldosActuales > 0) {
      elementoSaldos.innerHTML = String(saldosActuales - 1)
    }

  }, false)

  document.getElementById('btn-sumar-saldos').addEventListener('click', () => {
    let saldosActuales = Number(elementoSaldos.innerHTML)
    elementoSaldos.innerHTML = String(saldosActuales + 1)
  }, false)
  // event listeners !!

  function keyUp(e) {
    var elementoFocus = document.activeElement;

    var code = String(e.code)

    if (leyendoCodigo) {
      cadenaLectura += code[code.length - 1]
      if (cadenaLectura.length === 13) {
        limpiarCodigo()
        cadenaLectura = ''
        leyendoCodigo = false
        desseleccionar()
      }
    }
    else {
      if (code === 'Numpad0' || code === 'Digit0') {
        if (cadenaLectura === '') {
          cadenaLectura = '0'
        }
      }
      else if (code === 'Numpad4' || code === 'Digit4') {
        if (cadenaLectura === '0') {
          cadenaLectura += '4'
          leyendoCodigo = true
          setTimeout(function () {
            if (cadenaLectura === '04') {
              cadenaLectura = ''
              leyendoCodigo = false
            }
          }, 1000);

        }
      }
      else {
        cadenaLectura = ''
        leyendoCodigo = false
      }
    }



  }

</script>